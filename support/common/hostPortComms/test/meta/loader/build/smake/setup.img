/* Make all executing threads privileged */
MWR 0x04800010 0x00020000 /* Thread 0 */
MWR 0x04801010 0x00020000 /* Thread 1 */

/* Create TBI data structure (used by MeOS) */
TBI INT  THREAD 0 CCB 32
TBI BGND THREAD 0

/* PLL Config */
/* 180MHz output from 24.576 Crystal */
MWR 0x02005908 0x00000000 /* Bypass the PLL */
MPAUSE 1000               /* Wait for the switch over to happen*/
MWR 0x02005954 0x1600003F /* Put the PLL into reset */ 
/*set dividers first */
MWR 0x020059AC 0x00000001 /* CR_TOP_DDRCLKDIV - divide by 2 to get 180MHz DDR */
MWR 0x02005918 0x00000001 /* Turn on the sys clock divide to get 180MHz*/
MWR 0x0200599C 0x00000001 /* Clock out 1 divider */
MWR 0x02005950 0x3BF077F0 /* 360.188MHz*/
MPAUSE 1000               /* Wait for a bit*/ 
MWR 0x02005954 0x0600003f /* Take the PLL out of reset */
MWR 0x02005954 0x0400003f 
MPAUSE 2000               /* Wait for a bit more*/
MWR 0x02005908 0x00000002 /* Unbypass the PLL */
MWR 0x0200590C 0x00001220 /* Enable Clock out 1 and Clock out 0 */


MPAUSE 5000
/* Performing DDR Setup */
MWR 0x02006304 0x00000020 /*Reset the whole HEP not just DDR */
MPAUSE 5000


MWR 0x2008DE0 0x00000008
MWR 0x2008DE4 0x00000008
MWR 0x2008DE8 0x0000000F
MWR 0x2008DEC 0x00000000
MWR 0x2008DF0 0x00000000
MWR 0x2008DF4 0x00000000
MWR 0x2008DF8 0x00000000
MWR 0x2008DFC 0x00000000
MWR 0x2008E00 0x00000000
MWR 0x2008E04 0x0000000F
MWR 0x2008E08 0x0000000F
MWR 0x2008E0C 0x00000003
MWR 0x2008E10 0x00000003
MWR 0x2008E14 0x00000003
MWR 0x2008E18 0x00000003
MWR 0x2008E1C 0x0000000F
MWR 0x2008E20 0x0000000F
MWR 0x2008E24 0x0000000F
MWR 0x2008E34 0x00000005
MWR 0x2008E38 0x00000005
MWR 0x2008E3C 0x00000002
MWR 0x2008E40 0x00000002
MWR 0x2008E84 0x00000097
MWR 0x2008F6C 0x00000002
MWR 0x2008D3C 0x00000001
MWR 0x2008DB0 0x00000024
MWR 0x2008D4C 0x0000002c
MWR 0x2008D84 0x00000003
MWR 0x2008D40 0x0000000A
MWR 0x2008D68 0x00000003
MWR 0x2008D58 0x00000000
MWR 0x2008D5C 0x0000000D
MWR 0x2008D48 0x00000006
MWR 0x2008D7C 0x00000002
MWR 0x2008E88 0x00000002
MWR 0x2008E94 0x00000000
MWR 0x2008D60 0x00000009
MWR 0x2008D94 0x00000003
MWR 0x2008D80 0x00000003
MWR 0x2008F60 0x00000004
MWR 0x2008D50 0x00000009
MWR 0x2008DB4 0x00000002
MWR 0x2008D70 0x00000008
MWR 0x2008E28 0x00000001
MWR 0x2008D64 0x00000005
MWR 0x2008DBC 0x00002006
MWR 0x2008F64 0x00000005
MWR 0x2008DB8 0x00000552
MWR 0x2008D44 0x00000013
MWR 0x2008D8C 0x00000002
MWR 0x2008D6C 0x00000008
MWR 0x2008D74 0x00000002
MWR 0x2008D88 0x00000003

MWR 0x02008F94 0x0000003E
MWR 0x02008F98 0x0000003C
MWR 0x02008F9C 0x0000003E
MWR 0x02008FA0 0x0000003C


/* --- SOCFab Optimizer Configurations --- */
MWR 0x02008C50 0x00000008 /* CR_HEP_MEMOPT_TIMEOUT */
MWR 0x02008C54 0x00000003 /* CR_HEP_MEMOPT_BURST_LENGTH_MAX */
MWR 0x02008C58 0x00000030 /* CR_HEP_MEMOPT_TTE_MASK */
MWR 0x02008C5C 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE0 */
MWR 0x02008C60 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE1 */
MWR 0x02008C64 0x00000010 /* CR_HEP_MEMOPT_RAM_SIZE2 */
MWR 0x02008C68 0x00000010 /* CR_HEP_MEMOPT_RAM_SIZE3 */
MWR 0x02008C6C 0x00000010 /* CR_HEP_MEMOPT_RAM_SIZE4 */
MWR 0x02008C70 0x00000010 /* CR_HEP_MEMOPT_RAM_SIZE5 */
MWR 0x02008C74 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE6 */
MWR 0x02008C78 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE7 */
MWR 0x02008C7C 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE8 */
MWR 0x02008C80 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE9 */
MWR 0x02008C84 0x0000000F /* CR_HEP_MEMOPT_RAM_SIZE10 */
MWR 0x02008C88 0x00000009 /* CR_HEP_MEMOPT_READY_THRESHOLD0 */
MWR 0x02008C8C 0x00000009 /* CR_HEP_MEMOPT_READY_THRESHOLD1 */

/* The following 4 values have been modified to get DAB working with DDR */
MWR 0x02008C90 0x00000004 /* CR_HEP_MEMOPT_READY_THRESHOLD2 */
MWR 0x02008C94 0x00000004 /* CR_HEP_MEMOPT_READY_THRESHOLD3 */
MWR 0x02008C98 0x00000004 /* CR_HEP_MEMOPT_READY_THRESHOLD4 */
MWR 0x02008C9C 0x00000004 /* CR_HEP_MEMOPT_READY_THRESHOLD5 */

MWR 0x02008CA0 0x00000009 /* CR_HEP_MEMOPT_READY_THRESHOLD6 */
MWR 0x02008CA4 0x00000004 /* CR_HEP_MEMOPT_READY_THRESHOLD7 */
MWR 0x02008CA8 0x00000009 /* CR_HEP_MEMOPT_READY_THRESHOLD8 */
MWR 0x02008CAC 0x00000009 /* CR_HEP_MEMOPT_READY_THRESHOLD9 */
MWR 0x02008CB0 0x00000009 /* CR_HEP_MEMOPT_READY_THRESHOLD10 */
MWR 0x02008CB4 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE0 */
MWR 0x02008CB8 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE1 */
MWR 0x02008CBC 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE2 */
MWR 0x02008CC0 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE3 */
MWR 0x02008CC4 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE4 */
MWR 0x02008CC8 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE5 */
MWR 0x02008CCC 0x00000020 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE6 */
MWR 0x02008CD0 0x00000080 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE7 */
MWR 0x02008CD4 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE8 */
MWR 0x02008CD8 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE9 */
MWR 0x02008CDC 0x00000040 /* CR_HEP_MEMOPT_TIME_TO_EXPIRE10 */


/* Sys MTX Perip Optimizer Settings */
MWR 0x02009038 0x00000005 /* CR_MEMOPT_RAM_SIZE0 */
MWR 0x02009040 0x00000005 /* CR_MEMOPT_RAM_SIZE1 */
MWR 0x02009044 0x00000006 /* CR_MEMOPT_RAM_SIZE2 */
MWR 0x02009048 0x00000003 /* CR_MEMOPT_RAM_SIZE3 */
MWR 0x0200904C 0x00000006 /* CR_MEMOPT_RAM_SIZE4 */
MWR 0x02009050 0x00000003 /* CR_MEMOPT_RAM_SIZE5 */
MWR 0x02009054 0x00000007 /* CR_MEMOPT_RAM_SIZE6 */
MWR 0x02009058 0x00000005 /* CR_MEMOPT_RAM_SIZE7 */
MWR 0x0200905C 0x00000004 /* CR_MEMOPT_RAM_SIZE8 */
MWR 0x02009060 0x00000004 /* CR_MEMOPT_RAM_SIZE9 */
MWR 0x02009064 0x00000005 /* CR_MEMOPT_RAM_SIZE10 */
MWR 0x02009070 0x00000002 /* CR_MEMOPT_READY_THRESHOLD0 */
MWR 0x02009074 0x00000002 /* CR_MEMOPT_READY_THRESHOLD1 */
MWR 0x02009078 0x00000002 /* CR_MEMOPT_READY_THRESHOLD2 */
MWR 0x0200907C 0x00000002 /* CR_MEMOPT_READY_THRESHOLD3 */
MWR 0x02009080 0x00000002 /* CR_MEMOPT_READY_THRESHOLD4 */
MWR 0x02009084 0x00000002 /* CR_MEMOPT_READY_THRESHOLD5 */
MWR 0x02009088 0x00000002 /* CR_MEMOPT_READY_THRESHOLD6 */
MWR 0x0200908C 0x00000002 /* CR_MEMOPT_READY_THRESHOLD7 */
MWR 0x02009090 0x00000002 /* CR_MEMOPT_READY_THRESHOLD8 */
MWR 0x02009094 0x00000002 /* CR_MEMOPT_READY_THRESHOLD9 */
MWR 0x02009098 0x00000002 /* CR_MEMOPT_READY_THRESHOLD10 */

MWR 0x02008E7C 0x00000001 /* Take DDR out of Soft Reset */
MPAUSE 7000 /*was 6400*/ /*  Wait for the settings to take effect */

/* 
 * Turn on all peripheral clocks as the chip will lockup if the peripheral 
 * registers are accessed with these off
 */
MWR 0x02004010 0x00003fff

/* 
 * Setup Meta Core Tick Timer divider to get 1MHZ reference tick 
 * This register should be set to the meta core clk in MHZ -1
 */
MWR 0x03000040 359